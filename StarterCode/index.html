<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Bellybutton Biodiversity</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>

  <div class="container">
    <div class="row">
      <div class="col-md-12 p-5 text-center bg-light">
        <h1>Belly Button Biodiversity Dashboard</h1>
        <p>Use the interactive charts below to explore the dataset</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <div class="card card-body bg-light">
          <h6>Test Subject ID No.:</h6>
          <select id="selDataset" onchange="optionChanged(this.value)"></select>
        </div>
        <div class="card card-primary">
          <div class="card-header">
            <h4 class="card-title">Demographic Info</h4>
          </div>
          <div id="sample-metadata" class="card-body"></div>
        </div>
      </div>
      <div class="col-md-5">
        <div id="bar"></div>
      </div>
      <div class="col-md-5">
        <div id="gauge"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div id="bubble"></div>
      </div>
    </div>
  </div>

  <script src="./static/js/app.js"></script>
  <script src="./static/js/bonus.js"></script>

  <script>
    // Use D3 to read in the JSON file
    d3.json("https://static.bc-edx.com/data/dl-1-2/m14/lms/starter/samples.json").then(data => {
        // Extract necessary data
        const samples = data.samples;
        const metadata = data.metadata;

        // Create functions to generate visualizations and update them
        function createBarChart(sampleId) {
            const sample = samples.find(sample => sample.id === sampleId);
            const top10SampleValues = sample.sample_values.slice(0, 10);
            const top10OTUIDs = sample.otu_ids.slice(0, 10).map(id => `OTU ${id}`);
            const top10OTULabels = sample.otu_labels.slice(0, 10);

            const data = [{
                x: top10SampleValues,
                y: top10OTUIDs,
                text: top10OTULabels,
                type: 'bar',
                orientation: 'h'
            }];

            const layout = {
                title: 'Top 10 OTUs'
            };

            Plotly.newPlot('bar', data, layout);
        }

        function createBubbleChart(sampleId) {
            const sample = samples.find(sample => sample.id === sampleId);

            const trace = {
                x: sample.otu_ids,
                y: sample.sample_values,
                mode: 'markers',
                marker: {
                    size: sample.sample_values,
                    color: sample.otu_ids
                },
                text: sample.otu_labels
            };
            const layout = {
                title: 'OTU Bubble Chart',
                xaxis: {
                    title: 'OTU ID'
                },
                yaxis: {
                    title: 'Sample Value'
                }
            };
            Plotly.newPlot('bubble', [trace], layout);
        }

        function displayMetadata(sampleId) {
            const metadataRecord = metadata.find(record => record.id === parseInt(sampleId));
            const metadataDiv = d3.select("#sample-metadata");
            metadataDiv.html("");
            Object.entries(metadataRecord).forEach(([key, value]) => {
                metadataDiv.append("p").text(`${key}: ${value}`);
            });
        }

        function optionChanged(newSampleId) {
            createBarChart(newSampleId);
            createBubbleChart(newSampleId);
            displayMetadata(newSampleId);
        }

        // Populate dropdown menu with sample IDs
        const dropdown = d3.select("#selDataset");
        dropdown.selectAll("option")
            .data(samples.map(sample => sample.id))
            .enter()
            .append("option")
            .attr("value", d => d)
            .text(d => d);

        // Initialize with the first sample
        const initialSampleId = samples[0].id;
        optionChanged(initialSampleId);
    });
  </script>
</body>
</html>
